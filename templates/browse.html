<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
        <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

    <!-- Web Fonts -->
    <link href="//fonts.googleapis.com/css?family=Playfair+Display:400,700%7COpen+Sans:300,400,700" rel="stylesheet">

    <!-- Bootstrap Styles -->
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap.min.css' %}">

    <!-- Components Vendor Styles -->
    <script src="https://kit.fontawesome.com/020635d014.js" crossorigin="anonymous"></script>

    <!-- Theme Styles -->
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
    <style type="text/css">
        .table tr td{
            vertical-align: middle;
            text-align: center;
        }
    </style>

    <title>Browse</title>
</head>
<body data-spy="scroll" data-target="#bs-example-navbar-collapse-1" data-offset="100">
    <!-- Header -->
    <header role="header">
      <!-- Navbar -->
      <nav class="js-navbar-scroll navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand" href="/database/">
            HSDatabase
          </a>

          <button class="navbar-toggler" type="button"
                  data-toggle="collapse"
                  data-target="#navbarTogglerDemo"

                  aria-controls="navbarTogglerDemo"
                  aria-expanded="false"
                  aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo">

            <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
              <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link" href="/database/">Home</a>
              </li>
              <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link active" href="/database/browse/">Browse</a>
              </li>
              <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link" href="/database/search/">Search</a>
              </li>
                <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link" href="/database/blast/">Blast</a>
              </li>
                <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link" href="/database/kegg/">KEGG</a>
              </li>
                <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link" href="/database/faq/">Tutorial</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

    </header>
    <!-- End Header -->

    <main role="main">
        <section class="u-content-space">
            <div class="container">
              <ul class="nav nav-tabs nav-justified nav-tabs--v1" id="pills-tab" role="tablist">
              <li class="nav-item">
                  <a class="nav-link active" id="pills-tree-tab-1" href='#pills-tree-1' data-toggle="pill">Spieces Tree</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="pills-home-tab-1" href='#pills-home-1' data-toggle="pill">Plant, Chromista, Fungi</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="pills-profile-tab-1" href='#pills-profile-1' data-toggle="pill">Animal</a>
                </li>
              </ul>

              <div class="tab-content tab-content--v1" id="pills-tabContent">
              <div class="tab-pane fade show active" id="pills-tree-1" role="tabpanel" aria-labelledby="pills-tree-tab-1">
{#              <div class="align-self-center" id="svgCanvas"></div>#}
                  <svg></svg>
              </div>
                <div class="tab-pane fade" id="pills-home-1" role="tabpanel" aria-labelledby="pills-home-tab-1">
                    <p class="lead">&nbsp;</p>
                  <table class="table table-bordered table-striped">
{#                  <caption>description</caption>#}
                  <thead>
                    <tr class="text-primary">
                        <td style="width: 25%"><b>Organism</b></td>
                        <td style="width: 15%"><b>All HSDs</b></td>
                      <td style="width: 35%"><b>Description</b></td>
                        <td style="width: 25%"><b>Download</b></td>
                    </tr>
                  </thead>
                  <tbody>
                  {% for file in plant_files %}
                    <tr>
                        <td style="width: 25%"><a href="/database/hsd/{{ file.id }}/1/" >{{ file.name }}</a></td>
                        <td style="width: 8%">{{ file.hsds_num }}</td>
                        <td style="width: 62%; text-align: left;"><small>{{ file.description|safe }}</small></td>
                        <td style="width: 5%"><a href="/database/download/{{ file.id }}/" >
                            <i class="fas fa-download u-font-size-90 mr-1" style="color: #59287a"></i>
                        </a></td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                </div>
                <div class="tab-pane fade" id="pills-profile-1" role="tabpanel" aria-labelledby="pills-profile-tab-1">
                    <p class="lead">&nbsp;</p>
                  <table class="table table-bordered table-striped">
{#                  <caption>description</caption>#}
                  <thead>
                    <tr class="text-primary">
                        <td style="width: 25%"><b>Organism</b></td>
                        <td style="width: 15%"><b>All HSDs</b></td>
                      <td style="width: 35%"><b>Description</b></td>
                        <td style="width: 25%"><b>Download</b></td>
                    </tr>
                  </thead>
                  <tbody>
                  {% for file in animal_files %}
                    <tr>
                        <td style="width: 25%"><a href="/database/hsd/{{ file.id }}/1/" >{{ file.name }}</a></td>
                        <td style="width: 8%">{{ file.hsds_num }}</td>
                        <td style="width: 62%; text-align: left;"><small>{{ file.description|safe }}</small></td>
                        <td style="width: 5%"><a href="/database/download/{{ file.id }}/" >
                            <i class="fas fa-download u-font-size-90 mr-1" style="color: #59287a"></i>
                        </a></td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                </div>
              </div>
            </div>
        </section>
    </main>


    <!-- Footer -->
{#    <footer class="bg-dark py-2">#}
{#      <div class="container-fluid">#}
{#          <div class="text-center">#}
{#            <small class="text-white">&copy; 2020 <a class="text-white" href="">HSDFinder</a>. All Rights Reserved.</small>#}
{#        </div>#}
{#      </div>#}
{#    </footer>#}
    <!-- End Footer -->
    <!-- JAVASCRIPTS (Load javascripts at bottom, this will reduce page load time) -->
    <!-- Global Vendor -->
    <script src="{% static 'jquery.min.js' %}"></script>
    <script src="{% static 'jquery.migrate.min.js' %}"></script>
    <script src="{% static 'popper.min.js' %}"></script>
    <script src="{% static 'bootstrap.min.js' %}"></script>

    <!-- Components Vendor  -->
    <script src="{% static 'jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'jquery.parallax.js' %}"></script>

    <!-- Theme Settings and Calls -->
    <script src="{% static 'global.js' %}"></script>

    <!-- Theme Components and Settings -->
    <script src="{% static 'parallax.js' %}"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    function parseNewick(a){for(var e=[],r={},s=a.split(/\s*(;|\(|\)|,|:)\s*/),t=0;t<s.length;t++){var n=s[t];switch(n){case"(":var c={};r.branchset=[c],e.push(r),r=c;break;case",":var c={};e[e.length-1].branchset.push(c),r=c;break;case")":r=e.pop();break;case":":break;default:var h=s[t-1];")"==h||"("==h||","==h?r.name=n:":"==h&&(r.length=parseFloat(n))}}return r}
    var width = 900
    var outerRadius = width / 2
    var innerRadius = outerRadius - 240
    var data = parseNewick("((Fragilariopsis cylindrus:4)Chromista:4,(Hypsibius dujardini:4,Mus musculus:4,Drosophila melanogaster:4)Animal:4,(Saccharomyces cerevisiae:4)Fungi:4,((Zea mays:4,Arabidopsis thaliana:4)Magnoliopsida:4,(Coccomyxa subellipsoidea C-169:4,((Gonium pectorale:4,Volvox carteri:4)Volvocaceae:4,(Chlamydomonas sp. UWO 241:4,Chlamydomonas eustigma:4,Chlamydomonas sp. ICE-L:4,Chlamydomonas reinhardtii:4)Chlamydomonas:4,Dunaliella salina:4)Chlamydomonadales:4)Chlorophyta:4)Plant:4)Eukaryota:4;")
    legend = svg => {
      const g = svg
        .selectAll("g")
        .data(color.domain())
        .join("g")
          .attr("transform", (d, i) => `translate(${-outerRadius},${-outerRadius + i * 20})`);

      g.append("rect")
          .attr("width", 18)
          .attr("height", 18)
          .attr("fill", color);

      g.append("text")
          .attr("x", 24)
          .attr("y", 9)
          .attr("dy", "0.35em")
          .text(d => d);
    }
    function linkStep(startAngle, startRadius, endAngle, endRadius) {
      const c0 = Math.cos(startAngle = (startAngle - 90) / 180 * Math.PI);
      const s0 = Math.sin(startAngle);
      const c1 = Math.cos(endAngle = (endAngle - 90) / 180 * Math.PI);
      const s1 = Math.sin(endAngle);
      return "M" + startRadius * c0 + "," + startRadius * s0
          + (endAngle === startAngle ? "" : "A" + startRadius + "," + startRadius + " 0 0 " + (endAngle > startAngle ? 1 : 0) + " " + startRadius * c1 + "," + startRadius * s1)
          + "L" + endRadius * c1 + "," + endRadius * s1;
    }
    function linkExtensionConstant(d) {
      return linkStep(d.target.x, d.target.y, d.target.x, innerRadius);
    }
    function linkExtensionVariable(d) {
      return linkStep(d.target.x, d.target.radius, d.target.x, innerRadius);
    }
    function linkConstant(d) {
      return linkStep(d.source.x, d.source.y, d.target.x, d.target.y);
    }
    function linkVariable(d) {
      return linkStep(d.source.x, d.source.radius, d.target.x, d.target.radius);
    }
    function setColor(d) {
      var name = d.data.name;
      d.color = color.domain().indexOf(name) >= 0 ? color(name) : d.parent ? d.parent.color : null;
      if (d.children) d.children.forEach(setColor);
    }
    function setLinkId(d){
        var name = d.data.name;
        if (name === "Arabidopsis thaliana"){
            d.linkid = '13';
        }else if(name === "Coccomyxa subellipsoidea C-169"){
            d.linkid = '1';
        }else if(name === "Chlamydomonas eustigma"){
            d.linkid = '2';
        }else if(name === "Chlamydomonas reinhardtii"){
            d.linkid = '3';
        }else if(name === "Dunaliella salina"){
            d.linkid = '4';
        }else if(name === "Fragilariopsis cylindrus"){
            d.linkid = '5';
        }else if(name === "Saccharomyces cerevisiae"){
            d.linkid = '6';
        }else if(name === "Gonium pectorale"){
            d.linkid = '7';
        }else if(name === "Chlamydomonas sp. ICE-L"){
            d.linkid = '8';
        }else if(name === "Zea mays"){
            d.linkid = '14';
        }else if(name === "Chlamydomonas sp. UWO 241"){
            d.linkid = '9';
        }else if(name === "Volvox carteri"){
            d.linkid = '10';
        }else if(name === "Drosophila melanogaster"){
            d.linkid = '11';
        }else if(name === "Hypsibius dujardini"){
            d.linkid = '12';
        }else if(name === "Mus musculus"){
            d.linkid = '15';
        }
        if (d.children) d.children.forEach(setLinkId);
    }
    function setRadius(d, y0, k) {
      d.radius = (y0 += d.data.length) * k;
      if (d.children) d.children.forEach(d => setRadius(d, y0, k));
    }
    function maxLength(d) {
      return d.data.length + (d.children ? d3.max(d.children, maxLength) : 0);
    }
    color = d3.scaleOrdinal()
    .domain(["Chromista", "Fungi", "Plant", "Animal"])
    .range(d3.schemeCategory10)
    cluster = d3.cluster()
    .size([360, innerRadius])
    .separation((a, b) => 1)
    const root = d3.hierarchy(data, d => d.branchset)
      .sum(d => d.branchset ? 0 : 1)
      .sort((a, b) => (a.value - b.value) || d3.ascending(a.data.length, b.data.length));

  cluster(root);
  setRadius(root, root.data.length = 0, innerRadius / maxLength(root));
  setColor(root);
  setLinkId(root);

  const svg = d3.select("svg")
      .attr("viewBox", [-outerRadius, -outerRadius, width, width])
      .attr("font-family", "sans-serif")
      .attr("font-size", 14);

  svg.append("g")
      .call(legend);

  svg.append("style").text(`

.link--active {
  stroke: #000 !important;
  stroke-width: 1.5px;
}

.link-extension--active {
  stroke-opacity: .6;
}

.label--active {
  font-weight: bold;
  text-decoration: underline;
}

`);

  const linkExtension = svg.append("g")
      .attr("fill", "none")
      .attr("stroke", "#000")
      .attr("stroke-opacity", 0.2)
    .selectAll("path")
    .data(root.links().filter(d => !d.target.children))
    .join("path")
      .each(function(d) { d.target.linkExtensionNode = this; })
      .attr("d", linkExtensionConstant);

  const link = svg.append("g")
      .attr("fill", "none")
      .attr("stroke", "#000")
    .selectAll("path")
    .data(root.links())
    .join("path")
      .each(function(d) { d.target.linkNode = this; })
      .attr("d", linkConstant)
      .attr("stroke", d => d.target.color);

  svg.append("g")
    .selectAll("text")
    .data(root.leaves())
    .join("text")
      .attr("dy", ".31em")
      .attr("transform", d => `rotate(${d.x - 90}) translate(${innerRadius + 4},0)${d.x < 180 ? "" : " rotate(180)"}`)
      .attr("text-anchor", d => d.x < 180 ? "start" : "end")
      .attr("style", "cursor:pointer")
      .text(d => d.data.name.replace(/_/g, " "))
      .on("mouseover", mouseovered(true))
      .on("mouseout", mouseovered(false))
      .on("click", function(event, d) {
          var name = d.linkid;
          var url = '{% url 'hsd' 100 1 %}';
          document.location.href = url.replace('100', name);
        });

    const t = d3.transition().duration(750);
    linkExtension.transition(t).attr("d", linkExtensionVariable);
    link.transition(t).attr("d", linkVariable);


  function mouseovered(active) {
    return function(event, d) {
      d3.select(this).classed("label--active", active);
      d3.select(d.linkExtensionNode).classed("link-extension--active", active).raise();
      do d3.select(d.linkNode).classed("link--active", active).raise();
      while (d = d.parent);
    };
  }
</script>


</body>
</html>